version: "3.7"

services:
  momomo:
    image: alexmikhalochkin/momomo-worker:${MOMOMO_IMAGE_TAG}
    container_name: momomo
    environment:
      - TZ=${TIMEZONE}
    volumes:
      - ${MOMOMO_CONFIGURATION_DIRECTORY}:/config
    command: --spring.config.location=/config/
    restart: unless-stopped
    depends_on:
      - mosquitto

  mosquitto:
    image: alexmikhalochkin/mosquitto:${MOSQUITTO_IMAGE_TAG}
    container_name: mosquitto
    environment:
      - TZ=${TIMEZONE}
      - BRIDGE_ADDRESS=${AWS_IOT_BRIDGE_ADDRESS}
    ports:
      - "1883:1883"
    volumes:
      - ${AWS_IOT_CONFIGURATION_DIRECTORY}:/etc/mosquitto
    restart: unless-stopped

  plex:
    image: lscr.io/linuxserver/plex:${PLEX_IMAGE_TAG}
    container_name: plex
    network_mode: host
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TIMEZONE}
      - VERSION=docker
    volumes:
      - ${PLEX_CONTENT_DIRECTORY}/library:/config
      - ${PLEX_CONTENT_DIRECTORY}/tvseries:/tv
      - ${PLEX_CONTENT_DIRECTORY}/music:/music
      - ${PLEX_CONTENT_DIRECTORY}/movies:/movies
    restart: unless-stopped

  zigbee2mqtt:
    image: koenkk/zigbee2mqtt:${ZIGBEE_2_MQTT_IMAGE_TAG}
    container_name: zigbee2mqtt
    environment:
      - TZ=${TIMEZONE}
    volumes:
      - ${ZIGBEE_2_MQTT_CONFIGURATION_DIRECTORY}:/app/data
      - /run/udev:/run/udev:ro
    ports:
      - "8080:8080"
    devices:
      - /dev/ttyUSB0:/dev/ttyUSB0
    restart: unless-stopped
    depends_on:
      - mosquitto
